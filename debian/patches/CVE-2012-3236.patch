Description: fix denial of service via malformed .fit file header
Origin: upstream, http://git.gnome.org/browse/gimp/commit/plug-ins/file-fits/fits-io.c?id=ace45631595e8781a1420842582d67160097163c
Bug: https://bugzilla.gnome.org/show_bug.cgi?id=676804

Index: gimp-2.6.12/plug-ins/file-fits/fits-io.c
===================================================================
--- gimp-2.6.12.orig/plug-ins/file-fits/fits-io.c	2012-01-31 08:50:15.000000000 -0500
+++ gimp-2.6.12/plug-ins/file-fits/fits-io.c	2012-09-05 13:38:00.650225303 -0400
@@ -1055,10 +1055,18 @@
  hdulist->used.simple = (strncmp (hdr->data, "SIMPLE  ", 8) == 0);
  hdulist->used.xtension = (strncmp (hdr->data, "XTENSION", 8) == 0);
  if (hdulist->used.xtension)
- {
-   fdat = fits_decode_card (fits_search_card (hdr, "XTENSION"), typ_fstring);
-   strcpy (hdulist->xtension, fdat->fstring);
- }
+   {
+     fdat = fits_decode_card (fits_search_card (hdr, "XTENSION"), typ_fstring);
+     if (fdat != NULL)
+       {
+         strcpy (hdulist->xtension, fdat->fstring);
+       }
+     else
+       {
+         strcpy (errmsg, "No valid XTENSION header found.");
+         goto err_return;
+       }
+   }
 
  FITS_DECODE_CARD (hdr, "NAXIS", fdat, typ_flong);
  hdulist->naxis = fdat->flong;
